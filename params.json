{"name":"PHRETS","tagline":"RETS library in PHP","body":"Note: If you're looking for version 1, please see the \"1.x\" branch.  Otherwise, it's highly recommended that you use version 2+.\r\n\r\n[![Latest Stable Version](https://poser.pugx.org/troydavisson/PHRETS/v/stable.png)](https://packagist.org/packages/troydavisson/PHRETS)\r\n[![Total Downloads](https://poser.pugx.org/troydavisson/PHRETS/downloads.png)](https://packagist.org/packages/troydavisson/PHRETS)\r\n[![Build Status](https://travis-ci.org/troydavisson/PHRETS.svg?branch=2)](https://travis-ci.org/troydavisson/PHRETS)\r\n\r\n[![ScreenShot](http://troda.com/newfeatures.png)](http://youtu.be/115mx-9jYVM)\r\n\r\nPHRETS\r\n======\r\n\r\nPHP client library for interacting with a RETS server to pull real estate listings, photos and other data made available from an MLS system\r\n\r\n```php\r\n<?php\r\n\r\ndate_default_timezone_set('America/New_York');\r\n\r\nrequire_once(\"vendor/autoload.php\");\r\n\r\n$log = new \\Monolog\\Logger('PHRETS');\r\n$log->pushHandler(new \\Monolog\\Handler\\StreamHandler('php://stdout', \\Monolog\\Logger::DEBUG));\r\n\r\n$config = new \\PHRETS\\Configuration;\r\n$config->setLoginUrl('rets login url here')\r\n        ->setUsername('rets username here')\r\n        ->setPassword('rets password here')\r\n        ->setRetsVersion('1.7.2');\r\n\r\n$rets = new \\PHRETS\\Session($config);\r\n$rets->setLogger($log);\r\n\r\n$connect = $rets->Login();\r\n\r\n$system = $rets->GetSystemMetadata();\r\nvar_dump($system);\r\n\r\n$resources = $system->getResources();\r\n$classes = $resources->first()->getClasses();\r\nvar_dump($classes);\r\n\r\n$classes = $rets->GetClassesMetadata('Property');\r\nvar_dump($classes->first());\r\n\r\n$objects = $rets->GetObject('Property', 'Photo', '00-1669', '*', 1);\r\nvar_dump($objects);\r\n\r\n$fields = $rets->GetTableMetadata('Property', 'A');\r\nvar_dump($fields[0]);\r\n\r\n$results = $rets->Search('Property', 'A', '*', ['Limit' => 3, 'Select' => 'LIST_1,LIST_105,LIST_15,LIST_22,LIST_87,LIST_133,LIST_134']);\r\nforeach ($results as $r) {\r\n    var_dump($r);\r\n}\r\n```\r\n\r\n### Introduction\r\n\r\nPHRETS provides PHP developers a way to integrate RETS functionality directly within new or existing code by handling the following aspects for you:\r\n\r\n* Response parsing (XML, HTTP multipart, etc.)\r\n* Simple variables, arrays and objects returned to the developer\r\n* RETS communication (over HTTP)\r\n* HTTP Header management\r\n* Authentication\r\n* Session/Cookie management\r\n\r\n### Installation\r\n\r\nThe easiest way to get started is using [Composer](http://getcomposer.org) to install [troydavisson/phrets](https://packagist.org/packages/troydavisson/phrets):\r\n\r\n```js\r\n{\r\n    \"require\": {\r\n        \"troydavisson/phrets\": \"2.*\"\r\n    }\r\n}\r\n```\r\n \r\n\r\n### Get Help\r\nThe best place to ask for help is in our [Google Group](http://groups.google.com/group/phrets).  Please leave GitHub's issue tracker for bugs with the library.\r\n\r\n### Disclaimer  \r\nIn many cases, the capabilities provided by this library are dependent on these features being properly implemented by the RETS server you're accessing.  The RETS specification defines how clients and servers communicate, and if a server is doing something unexpected, this library may not work without tweaking some options.\r\n\r\n## Documentation\r\n\r\n#### Configuration\r\n\r\nThe first step with getting connected to a RETS server is to configure the connection.\r\n\r\n```php\r\n$config = new \\PHRETS\\Configuration;\r\n$config->setLoginUrl($rets_login_url);\r\n$config->setUsername($rets_username);\r\n$config->setPassword($rets_password);\r\n\r\n// optional.  value shown below are the defaults used when not overridden\r\n$config->setRetsVersion('1.7.2'); // see constants from \\PHRETS\\Versions\\RETSVersion\r\n$config->setUserAgent('PHRETS/2.0');\r\n$config->setUserAgentPassword($rets_user_agent_password); // string password, if given\r\n$config->setOption('use_post_method', false); // boolean\r\n$config->setOption('disable_follow_location', false); // boolean\r\n```\r\n\r\nAvailable options are:\r\n\r\n* `use_post_method` - Always use HTTP POST instead of HTTP GET.  Default is `false` (uses GET)\r\n* `disable_follow_location` - Disable the ability to automatically handle redirects sent by the server.  Default is `false` (follow redirects)\r\n\r\nAs an alternative, you can also load configuration options from an array:\r\n\r\n```php\r\n$config = Configuration::load([\r\n    'login_url' => 'http://loginurlhere',\r\n    'username' => 'rets_username',\r\n    'password' => 'rets_password',\r\n    'user_agent' => 'UserAgent/1.0',\r\n    'user_agent_password' => 'user_agent_password_here',\r\n    'rets_version' => '1.8',\r\n]);\r\n```\r\n\r\n#### Connecting\r\n\r\nOnce the configuration has been setup, a RETS session can be started:\r\n\r\n```php\r\n$config = Configuration::load([\r\n    see above for what to give here\r\n]);\r\n\r\n$rets = new \\PHRETS\\Session($config);\r\n```\r\n\r\n#### Login\r\n\r\n```php\r\n$bulletin = $rets->Login();\r\n```\r\n\r\nThis will make the first request to the RETS server.  In addition to general authentication, this step is required to finalize the session's configuration.  Within the Login response, RETS servers provide back information needed for all other requests, so this has to be done first.\r\n\r\n#### Grabbing Records\r\n\r\n> Note: In order to grab records from a RETS server, you need to first know the types of information you're allowed to get and see.  This information is provided through the metadata calls supported by a RETS server, but using a RETS metadata viewer service such as [RETSMD.com](http://retsmd.com/) can make this process much faster unless you have a specific need for having parseable metadata.\r\n\r\nWith a known RETS Resource, Class and DMQL query, you can issue requests for records:\r\n\r\n```php\r\n$results = $rets->Search($resource, $class, $query);\r\n\r\n// or with the additional options (with defaults shown)\r\n\r\n$results = $rets->Search(\r\n    $resource,\r\n    $class,\r\n    $query,\r\n    [\r\n        'QueryType' => 'DMQL2',\r\n        'Count' => 1, // count and records\r\n        'Format' => 'COMPACT-DECODED',\r\n        'Limit' => 99999999,\r\n        'StandardNames' => 0, // give system names\r\n    ]\r\n);\r\n```\r\n\r\n#### Processing Results\r\n\r\nThe result of a `$rets->Search()` request will return a `\\PHRETS\\Models\\Search\\Results` object which can be used, in many ways, like a regular array.  Each item in that array is a `\\PHRETS\\Models\\Search\\Record` object representing a single record returned.\r\n\r\n```php\r\n$results = $rets->Search( see above for what to give here );\r\n\r\nforeach ($results as $record) {\r\n    echo $record['Address'] . \"\\n\";\r\n    // is the same as:\r\n    echo $record->get('Address') . \"\\n\";\r\n}\r\n```\r\n\r\n$results can be used in a foreach loop like above, but some additional helper methods exist:\r\n\r\n```php\r\n// return an array of the field names to expect with each record\r\n$results->getHeaders();\r\n\r\n// return the total number of results found (reported by the RETS server)\r\n$results->getTotalResultsCount();\r\n\r\n// return the count of results actually retrieved by PHRETS\r\n$results->getReturnedResultsCount(); // same as: count($results)\r\n\r\n// make a RETS GetMetadata call for the metadata for this RETS Resource and Class\r\n$results->getMetadata();\r\n\r\n// return whether or not the RETS server has more results to give\r\n$results->isMaxRowsReached();\r\n\r\n// return the string of characters to expect as the value of a field the RETS server blocked\r\n$results->getRestrictedIndicator();\r\n\r\n// return the first record in the set\r\n$results->first();\r\n\r\n// return the last record in the set\r\n$results->last();\r\n\r\n// returns an array representing the collected values from the identified field\r\n$all_ids = $results->lists('ListingID');\r\n```\r\n\r\nBecause each $record is an object, some helper methods exist:\r\n\r\n```php\r\n$record->isRestricted('Address'); // determine if the RETS server blocked this value\r\n$record->getFields(); // return an array of the field names associated with this record\r\n$record->toArray(); // returns a true PHP array of the given record\r\n$record->toJson(); // returns a JSON encoded string representing the record\r\n$record->getResource(); // returns the RETS Resource responsible for this record\r\n$record->getClass(); // returns the RETS Class responsible for this record\r\n```\r\n\r\n#### Downloading Media (Photos, Images, Documents, etc.)\r\n\r\nThe returned value from a `$rets->GetObject()` call is a `\\Illuminate\\Support\\Collection` object which allows many common array-like features as well as some helper methods.\r\n\r\n```php\r\n$objects = $rets->GetObject($rets_resource, $object_type, $object_keys);\r\n\r\n// grab the first object of the set\r\n$objects->first();\r\n\r\n// grab the last object of the set\r\n$objects->last();\r\n\r\n// throw out everything but the first 10 objects\r\n$objects = $objects->slice(0, 10);\r\n```\r\n\r\nEach object within that collection is a `\\PHRETS\\Models\\Object` object with it's own set of helper methods:\r\n\r\n```php\r\n$objects = $rets->GetObject( see above documentation );\r\nforeach ($objects as $object) {\r\n    // does this represent some kind of error\r\n    $object->isError();\r\n    $object->getError(); // returns a \\PHRETS\\Models\\RETSError\r\n\r\n    // get the record ID associated with this object\r\n    $object->getContentId();\r\n\r\n    // get the sequence number of this object relative to the others with the same ContentId\r\n    $object->getObjectId();\r\n\r\n    // get the object's Content-Type value\r\n    $object->getContentType();\r\n\r\n    // get the description of the object\r\n    $object->getContentDescription();\r\n\r\n    // get the sub-description of the object\r\n    $object->getContentSubDescription();\r\n\r\n    // get the object's binary data\r\n    $object->getContent();\r\n\r\n    // get the size of the object's data\r\n    $object->getSize();\r\n\r\n    // does this object represent the primary object in the set\r\n    $object->isPreferred();\r\n\r\n    // when requesting URLs, access the URL given back\r\n    $object->getLocation();\r\n\r\n    // use the given URL and make it look like the RETS server gave the object directly\r\n    $object->setContent(file_get_contents($object->getLocation()));\r\n}\r\n```\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}